let e="/";function t(e){e+="State";let t=history[e];history[e]=function(n){let r=new Event(e.toLowerCase());return r.uri=n,t.apply(this,arguments),dispatchEvent(r)}}module.exports=function(n,r){let s,l=[],u={},a={},i=a.format=(e=>e?(e="/"+e.replace(/^\/|\/$/g,""),s?s.test(e)&&(e.replace(s,"")||"/"):e):e);return"/"===(n=i(n))&&(n=""),n&&(s=new RegExp("^/?"+n.substring(1)+"(?=/|$)","i")),a.route=((e,t)=>{history[(t?"replace":"push")+"State"](n+e,null,n+e)}),a.on=((t,n)=>{u[t]=n;let r=function(t){let n,r,s,l=t.split(e);""===l[0]&&l.shift();let u,a=0,i=[],o="";for(;a<l.length;a++)0!==(s=(u=l[a]).length)&&(42===(n=u.charCodeAt(0))?(i.push("wild"),o+=e+"(.*)"):58===n?(r=63===u.charCodeAt(s-1),i.push(u.substring(1,r?s-1:s)),o+=r?"(?:/([^/]+?))?":e+"([^/]+?)"):o+=e+u);return i.length&&(o+="(?:/)?"),{keys:i,pattern:o=new RegExp("^"+o+"/?$","i")}}(t);return r.route=t,l.push(r),a}),a.run=(e=>{e=i(e||location.pathname);let t=l.find(t=>t.pattern.test(e));if(t){let n=0,r={},s=t.pattern.exec(e);for(;n<t.keys.length;)r[t.keys[n]]=s[++n]||null;u[t.route](r)}else e&&r&&r(e);return a}),a.listen=(()=>{function e(e){a.run(e.uri)}function n(e){let t,n=e.target.closest("a");n&&n.href&&!n.target&&(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button||(t=i(n.getAttribute("href")))&&(e.preventDefault(),a.route(t)))}t("push"),t("replace");let r=removeEventListener;return addEventListener("popstate",e),addEventListener("replacestate",e),addEventListener("pushstate",e),addEventListener("click",n),a.unlisten=(()=>{r("popstate",e),r("replacestate",e),r("pushstate",e),r("click",n)}),a.run()}),a};
